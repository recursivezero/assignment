---
import Header from "./Header.astro";
import LightDarkMode from "../components/lightDarkMode.astro";
---

<style>
  @font-face 
  {
      font-family: gilroy;
      src: url(/gilroy/Gilroy-Regular.ttf);
  }

  div #navbar
  {
    background-color: #000;
  }

  #navbar
  {
    background: none;
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 20px;
    margin-bottom: -1.8em;
    transition: background-color 0.3s, color 0.3s; /* Smooth transition */
  }

  #languageSwitcher
  {
    padding: 0.5em;
    background: none;
    border-radius: 10px;
    border: none;
    background-color: #000;
    color: #ffffff;
    box-shadow: rgba(255, 255, 255, 0.886) 0px 3px 8px;
  }

  #theme-toggle
  {
    background-color: rgb(23, 23, 23);
    border-radius: 20px;
    padding: 0.2em;
    border: none;
    box-shadow: rgb(255, 255, 255) 0px 3px 8px;
  }

  #theme-toggle:hover
  {
    transform: scale(1.2);
  }

</style>

<nav>
  <div id="navbar">
    <Header/>
    <!-- Language Selector -->
    <select id="languageSwitcher">
      <option value="en">English</option>
      <option value="hindi">Hindi</option>
    </select>
    <LightDarkMode/>
  </div>
</nav>

<script>
  const translations = {};
  let currentLanguage = localStorage.getItem("language") || 'en';  // Get language from localStorage or default to 'en'

  // Load language data
  async function loadLanguage(lang) {
    try {
      const response = await fetch(`/locales/${lang}.json`);
      if (!response.ok) {
        throw new Error(`Failed to fetch language file: ${lang}`);
      }
      translations[lang] = await response.json();
      currentLanguage = lang;
      localStorage.setItem("language", lang);  // Save the selected language to localStorage
      updateContent(); // Update the content with the newly loaded language
    } catch (error) {
      console.error('Error loading language:', error);
    }
  }

  // Translate text based on the key
  function translate(key) {
    return translations[currentLanguage]?.[key] || key;
  }

  // Update all text content with the selected language
  function updateContent() {
    document.querySelectorAll('[data-i18n]').forEach((element) => {
      const key = element.getAttribute('data-i18n');
      element.textContent = translate(key);
    });
  }

  // Event listener for language change
  document.getElementById('languageSwitcher').addEventListener('change', (event) => {
    const selectedLanguage = event.target.value;
    loadLanguage(selectedLanguage);
  });

  // Initialize the page with the language from localStorage (or default language)
  window.addEventListener("DOMContentLoaded", () => {
    loadLanguage(currentLanguage); // Load language from localStorage or default
    document.getElementById('languageSwitcher').value = currentLanguage; // Set the dropdown to the selected language
  });

</script>
